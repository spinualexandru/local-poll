<div data-poll-id="{{dynamicParams.id}}">
  <p id="pollName"></p>
  <div id="voteResults"></div>
</div>

<script type="module">
  import { getPollById } from "/services/poll.mjs";
  import { getVotesByPollId } from "/services/vote.mjs";

  const pollId = "{{dynamicParams.id}}";

  getPollById(pollId)
    .then((pollResult) => {
      const elem = document.getElementById("pollName");
      elem.textContent = pollResult.data.question;
      const poll = pollResult.data;

      getVotesByPollId(pollId)
        .then((data) => {
          const voteResultsDiv = document.getElementById("voteResults");
          voteResultsDiv.innerHTML = "";

          const voteCounts = data.data.reduce((acc, vote) => {
            acc[vote.option_id] = (acc[vote.option_id] || 0) + 1;
            return acc;
          }, {});

          for (const [optionId, count] of Object.entries(voteCounts)) {
            const resultElem = document.createElement("div");
            resultElem.textContent = `${poll.options[optionId]}: ${count} votes`;
            voteResultsDiv.appendChild(resultElem);
          }
        })
        .catch((error) => console.error(error));
    })
    .catch((error) => console.error(error));
</script>
